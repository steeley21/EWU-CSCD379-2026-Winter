import{d as O,K as Le,x as A,y as R,L as ne,M as te,N as le,k as u,z as E,A as P,g as j,_ as Y,f as m,B as s,C as f,O as B,J as ie,D as H,o as ce,c as se,P as _,Q as De,R as Re}from"./DHB8BPUp.js";import{u as Fe}from"./D2eRqykY.js";function ue(e,n,t="."){const a=[];for(let r=0;r<e;r++){const l=[];for(let i=0;i<n;i++)l.push({terrain:t,entity:null});a.push(l)}return a}const Ue=["data-terrain","data-entity","data-state","aria-label","onClick"],Be={class:"hg-glyph"},ze=O({__name:"GameGrid",props:{cells:{},rows:{default:14},cols:{default:24},cellSizePx:{default:24},gapPx:{default:2},playerChar:{default:"☻"},infectedChar:{default:"☺"},enemyChar:{default:"E"},resourceChar:{default:"*"},terrainGlyphs:{default:()=>({".":".","^":"^","~":"~","#":"#"})}},emits:["cell-click"],setup(e,{emit:n}){const t=e,a=n,r=j([]);function l(){const c=t.rows,d=t.cols,h=ue(c,d,"."),b=Math.floor(c/2),g=Math.floor(d/2);h[b][g].entity="player",r.value=h}Le(()=>[t.rows,t.cols],()=>l(),{immediate:!0});const i=u(()=>t.cells&&t.cells.length?t.cells:r.value),v=u(()=>({"--hg-cell":`${t.cellSizePx}px`,"--hg-gap":`${t.gapPx}px`}));function o(c,d,h){a("cell-click",{row:c,col:d,cell:h})}function p(c){switch(c.entity){case"player":return t.playerChar;case"infected":return t.infectedChar;case"enemy":return t.enemyChar;case"resource":return t.resourceChar;default:return t.terrainGlyphs[c.terrain]??c.terrain}}return(c,d)=>(A(),R("div",{class:"hg-grid-wrap",style:le(v.value),role:"grid","aria-label":"Hivefall grid"},[(A(!0),R(ne,null,te(i.value,(h,b)=>(A(),R("div",{key:b,class:"hg-row",role:"row"},[(A(!0),R(ne,null,te(h,(g,k)=>(A(),R("button",{key:k,type:"button",class:"hg-cell",role:"gridcell","data-terrain":g.terrain,"data-entity":g.entity??"none","data-state":g.state??"normal","aria-label":`Row ${b+1} Col ${k+1}`,onClick:y=>o(b,k,g)},[E("span",Be,P(p(g)),1)],8,Ue))),128))]))),128))],4))}}),Te=Y(ze,[["__scopeId","data-v-f6ebe51a"]]),Ge={class:"dp-row"},Ke={class:"dp-row dp-mid"},Oe={class:"dp-row"},Ve=O({__name:"DPad",props:{disabled:{type:Boolean},onUp:{},onDown:{},onLeft:{},onRight:{},btnSizePx:{default:48},gapPx:{default:10},padPx:{default:10}},setup(e){const n=e,t=u(()=>({"--dp-btn":`${n.btnSizePx}px`,"--dp-gap":`${n.gapPx}px`,"--dp-pad":`${n.padPx}px`}));return(a,r)=>{const l=m("v-icon"),i=m("v-btn");return A(),R("div",{class:"dp-wrap",style:le(t.value),role:"group","aria-label":"Movement controls"},[E("div",Ge,[s(i,{class:"dp-btn",icon:"",disabled:e.disabled,"aria-label":"Move up",onClick:B(e.onUp,["stop"])},{default:f(()=>[s(l,{icon:"mdi-chevron-up"})]),_:1},8,["disabled","onClick"])]),E("div",Ke,[s(i,{class:"dp-btn",icon:"",disabled:e.disabled,"aria-label":"Move left",onClick:B(e.onLeft,["stop"])},{default:f(()=>[s(l,{icon:"mdi-chevron-left"})]),_:1},8,["disabled","onClick"]),r[0]||(r[0]=E("div",{class:"dp-center","aria-hidden":"true"},null,-1)),s(i,{class:"dp-btn",icon:"",disabled:e.disabled,"aria-label":"Move right",onClick:B(e.onRight,["stop"])},{default:f(()=>[s(l,{icon:"mdi-chevron-right"})]),_:1},8,["disabled","onClick"])]),E("div",Oe,[s(i,{class:"dp-btn",icon:"",disabled:e.disabled,"aria-label":"Move down",onClick:B(e.onDown,["stop"])},{default:f(()=>[s(l,{icon:"mdi-chevron-down"})]),_:1},8,["disabled","onClick"])])],4)}}}),We=Y(Ve,[["__scopeId","data-v-1271ceb5"]]),Ne={class:"mt-2"},je={class:"d-flex justify-center ga-2 mt-4"},Ye=O({__name:"FightDialog",props:{modelValue:{type:Boolean},enemyId:{},hp:{},maxHp:{},infected:{},maxEnemies:{}},emits:["update:modelValue","attack","run","close"],setup(e){return(n,t)=>{const a=m("v-card-title"),r=m("v-chip"),l=m("v-card-text"),i=m("v-btn"),v=m("v-spacer"),o=m("v-card-actions"),p=m("v-card"),c=m("v-dialog");return A(),ie(c,{"model-value":e.modelValue,"max-width":"520",persistent:""},{default:f(()=>[s(p,null,{default:f(()=>[s(a,{class:"text-h6 text-center"},{default:f(()=>[...t[3]||(t[3]=[H("Fight!",-1)])]),_:1}),s(l,{class:"text-body-2"},{default:f(()=>[t[4]||(t[4]=E("div",null,"You encountered an enemy.",-1)),E("div",Ne,"Enemy ID: "+P(e.enemyId??"—"),1),E("div",je,[s(r,{label:"",size:"small"},{default:f(()=>[H("HP "+P(e.hp)+" / "+P(e.maxHp),1)]),_:1}),s(r,{label:"",size:"small"},{default:f(()=>[H("Infected "+P(e.infected)+" / "+P(e.maxEnemies),1)]),_:1})])]),_:1}),s(o,null,{default:f(()=>[s(i,{variant:"outlined",onClick:t[0]||(t[0]=d=>n.$emit("run"))},{default:f(()=>[...t[5]||(t[5]=[H("Run",-1)])]),_:1}),s(v),s(i,{color:"primary",variant:"text",onClick:t[1]||(t[1]=d=>n.$emit("attack"))},{default:f(()=>[...t[6]||(t[6]=[H("Attack",-1)])]),_:1})]),_:1}),s(o,{class:"pt-0"},{default:f(()=>[s(i,{block:"",variant:"text",onClick:t[2]||(t[2]=d=>n.$emit("close"))},{default:f(()=>[...t[7]||(t[7]=[H("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),K={rows:14,cols:24,terrain:".",maxEnemies:10,firstSpawnAfterMoves:5,spawnPacing:{minInterval:2,decreaseEverySpawns:2,step:1},playerMaxHp:20,damagePerFight:1};function Je(e={}){return{...K,...e,spawnPacing:{...K.spawnPacing,...e.spawnPacing??{}}}}function z(e,n){return Math.floor(n()*e)}function Qe(e,n,t=Math.random){const a=Math.floor(t()*4);return a===0?{row:0,col:z(n,t)}:a===1?{row:e-1,col:z(n,t)}:a===2?{row:z(e,t),col:0}:{row:z(e,t),col:n-1}}function Xe(e,n,t,a=Math.random,r=50){for(let l=0;l<r;l++){const i=Qe(e,n,a);if(!t(i))return i}return null}function oe(e,n){return e.row===n.row&&e.col===n.col}function ae(e){return e>0?1:e<0?-1:0}function qe(e,n,t){return e.row>=0&&e.row<n&&e.col>=0&&e.col<t}function Ze(e,n,t,a,r){const l=n.row-e.row,i=n.col-e.col,v=ae(l),o=ae(i),c=Math.abs(l)>=Math.abs(i)?[{row:e.row+v,col:e.col},{row:e.row,col:e.col+o}]:[{row:e.row,col:e.col+o},{row:e.row+v,col:e.col}];for(const d of c)if(!oe(d,e)&&qe(d,t,a)){if(oe(d,n))return d;if(!r(d))return d}return e}function en(e){const n=e.movesSinceLastSpawn+1;return n>=e.currentInterval?{shouldSpawn:!0,next:{currentInterval:e.currentInterval,movesSinceLastSpawn:0}}:{shouldSpawn:!1,next:{currentInterval:e.currentInterval,movesSinceLastSpawn:n}}}function nn(e,n,t={}){const a=t.minInterval??1,r=t.decreaseEverySpawns??1,l=t.step??1;return r<=1?Math.max(a,e-l):n%r!==0?e:Math.max(a,e-l)}function tn(e){switch(e){case"up":return{dr:-1,dc:0};case"down":return{dr:1,dc:0};case"left":return{dr:0,dc:-1};case"right":return{dr:0,dc:1}}}function on(e,n){return{row:e.row+n.dr,col:e.col+n.dc}}function an(e,n,t){return e.row>=0&&e.row<n&&e.col>=0&&e.col<t}function rn(e,n,t,a,r=()=>!1){const l=on(e,tn(n));return an(l,t,a)?r(l)?{ok:!1,to:l,reason:"blocked"}:{ok:!0,to:l}:{ok:!1,to:l,reason:"out_of_bounds"}}function de(e,n){return e.row===n.row&&e.col===n.col}function ln(e){return e==="^"||e==="#"}function fe(e){return e.state==="blocked"?!0:ln(e.terrain)}function cn(e,n){return e.find(t=>de(t.pos,n))}function sn(e,n,t){const a=e[t.row]?.[t.col];if(!a)return{kind:"blocked",reason:"terrain"};if(fe(a))return{kind:"blocked",reason:"terrain"};const r=cn(n,t);return r?{kind:"fight",enemyId:r.id}:{kind:"ok"}}function un(e,n,t,a){const r=e[a.row]?.[a.col];return r?fe(r)?{kind:"blocked",reason:"terrain"}:de(a,n)?{kind:"fight",enemyId:t}:{kind:"ok"}:{kind:"blocked",reason:"terrain"}}function T(e){return e.map(n=>n.map(t=>({...t})))}function N(e,n){return e.row===n.row&&e.col===n.col}function dn(e,n){return{row:Math.floor(e/2),col:Math.floor(n/2)}}function L(e,n,t){e[n.row][n.col]={...e[n.row][n.col],entity:t}}function fn(e,n){return e.find(t=>N(t.pos,n))}function re(e){const n=ue(e.rows,e.cols,e.terrain),t=dn(e.rows,e.cols);return L(n,t,"player"),{grid:n,playerPos:t,enemies:[],moveCount:0,fight:null,infectedCount:0,status:"playing",playerHp:e.playerMaxHp,currentSpawnInterval:e.firstSpawnAfterMoves,movesSinceLastSpawn:0,nextEnemyId:1}}function pn(e,n,t,a={}){if(e.status!=="playing"||e.fight)return e;const r=rn(e.playerPos,t,n.rows,n.cols);if(!r.ok)return e;const l=r.to,i=sn(e.grid,e.enemies,l);if(i.kind==="blocked")return e;if(i.kind==="fight")return{...e,fight:{enemyId:i.enemyId}};let v=T(e.grid);L(v,e.playerPos,null),L(v,l,"player");let o={...e,grid:v,playerPos:l,moveCount:e.moveCount+1};if((()=>{if(o.enemies.length===0)return;let y=T(o.grid);const S=new Set(o.enemies.map(C=>`${C.pos.row},${C.pos.col}`)),w=[];for(let C=0;C<o.enemies.length;C++){const x=o.enemies[C],U=I=>S.has(`${I.row},${I.col}`),M=Ze(x.pos,o.playerPos,n.rows,n.cols,U),F=un(y,o.playerPos,x.id,M);if(F.kind==="fight"){o={...o,fight:{enemyId:x.id}},w.push(x);for(let I=C+1;I<o.enemies.length;I++)w.push(o.enemies[I]);o={...o,enemies:w,grid:y};return}if(F.kind==="blocked"){w.push(x);continue}if(N(M,x.pos)){w.push(x);continue}S.delete(`${x.pos.row},${x.pos.col}`),S.add(`${M.row},${M.col}`),L(y,x.pos,null),L(y,M,"enemy"),w.push({...x,pos:M})}o={...o,enemies:w,grid:y}})(),o.fight)return o;const p=en({currentInterval:o.currentSpawnInterval,movesSinceLastSpawn:o.movesSinceLastSpawn});let c=p.next.movesSinceLastSpawn,d=p.next.currentInterval,h=o.enemies,b=o.grid,g=o.nextEnemyId;const k=g-1;if(p.shouldSpawn&&k<n.maxEnemies){const y=a.rng??Math.random,S=Xe(n.rows,n.cols,w=>N(w,o.playerPos)||!!fn(h,w),y,50);if(S){const w=T(b);L(w,S,"enemy"),b=w,h=[...h,{id:g++,pos:S}];const C=g-1;d=nn(d,C,{minInterval:n.spawnPacing.minInterval,decreaseEverySpawns:n.spawnPacing.decreaseEverySpawns,step:n.spawnPacing.step})}}return G({...o,enemies:h,grid:b,movesSinceLastSpawn:c,currentSpawnInterval:d,nextEnemyId:g},n)}function G(e,n){if(e.status!=="playing")return e;if(e.playerHp<=0)return{...e,status:"lost"};const a=e.nextEnemyId-1>=n.maxEnemies,r=e.infectedCount>=n.maxEnemies,l=e.enemies.length===0;return!e.fight&&a&&r&&l?{...e,status:"won"}:e}function vn(e,n,t){if(e.status!=="playing"||!e.fight)return e;const a=n.damagePerFight;if(t==="run"){const o={...e,playerHp:e.playerHp-a,fight:null};return G(o,n)}const r=e.fight.enemyId,l=e.enemies.find(o=>o.id===r);if(!l){const o={...e,playerHp:e.playerHp-a,fight:null};return G(o,n)}const i=T(e.grid);L(i,l.pos,"infected");const v={...e,grid:i,enemies:e.enemies.filter(o=>o.id!==r),infectedCount:e.infectedCount+1,playerHp:e.playerHp-a,fight:null};return G(v,n)}function mn(e){return e.status!=="playing"?e:{...e,status:"lost",fight:null}}function gn(e){return e.fight?{...e,fight:null}:e}function wn(e={}){const n=Je(e),t=j(re(n)),a=u(()=>t.value.grid),r=u(()=>t.value.fight),l=u(()=>t.value.status),i=u(()=>t.value.playerHp),v=u(()=>n.playerMaxHp),o=u(()=>n.maxEnemies),p=u(()=>t.value.moveCount),c=u(()=>t.value.infectedCount);function d(){t.value=re(n)}function h(){t.value=gn(t.value)}function b(y){t.value=vn(t.value,n,y)}function g(){t.value=mn(t.value)}function k(y){t.value=pn(t.value,n,y)}return{rules:n,state:t,moveCount:p,infectedCount:c,grid:a,fight:r,status:l,playerHp:i,playerMaxHp:v,maxEnemies:o,reset:d,clearFight:h,resolveFight:b,giveUp:g,moveUp:()=>k("up"),moveDown:()=>k("down"),moveLeft:()=>k("left"),moveRight:()=>k("right")}}function hn(e){const n=e.target;if(!n)return!1;const t=n.tagName;return!!(t==="INPUT"||t==="TEXTAREA"||t==="SELECT"||n.isContentEditable)}function yn(e){const n=j(!0),t=u(()=>e.enabled===void 0?n.value:!!_(e.enabled)),a=e.allowArrows??!0,r=e.allowWASD??!0,l=e.preventScroll??!0,i={passive:!1};function v(p){if(!t.value||hn(p)||p.altKey||p.ctrlKey||p.metaKey)return;let c=!1;if(a)switch(p.key){case"ArrowUp":e.onUp(),c=!0;break;case"ArrowDown":e.onDown(),c=!0;break;case"ArrowLeft":e.onLeft(),c=!0;break;case"ArrowRight":e.onRight(),c=!0;break}if(!c&&r)switch(p.code){case"KeyW":e.onUp(),c=!0;break;case"KeyS":e.onDown(),c=!0;break;case"KeyA":e.onLeft(),c=!0;break;case"KeyD":e.onRight(),c=!0;break}c&&l&&p.preventDefault()}ce(()=>{window.addEventListener("keydown",v,i)}),se(()=>{window.removeEventListener("keydown",v,i)});function o(p){n.value=p}return{enabled:t,setEnabled:o}}const xn={class:"mt-1"},_n=64,bn=16,kn=O({__name:"hivefall",setup(e){const n=K.rows,t=K.cols,{width:a,height:r,mdAndUp:l}=De(),i=u(()=>!l.value),v=u(()=>r.value<820?8:10),o=u(()=>10),p=u(()=>r.value<820?1:2),c=u(()=>Math.max(240,r.value-_n-bn)),d=u(()=>{const $=Math.floor((c.value-2*o.value-2*v.value)/3);return Math.max(34,Math.min(52,$))}),h=u(()=>3*d.value+2*v.value+2*o.value),b=u(()=>3*d.value+2*v.value+2*o.value),g=u(()=>i.value?Math.max(160,c.value-h.value-12):c.value),k=u(()=>i.value?Math.max(320,a.value-32):Math.max(320,a.value-b.value-48)),y=u(()=>{const $=Math.floor((k.value-(t-1)*p.value)/t),D=Math.floor((g.value-(n-1)*p.value)/n);return Math.max(10,Math.min(24,Math.min($,D)))}),{resetFn:S,giveUpFn:w}=Fe(),{grid:C,reset:x,moveUp:U,moveDown:M,moveLeft:F,moveRight:I,fight:V,clearFight:J,resolveFight:Q,status:W,giveUp:pe,moveCount:ve,infectedCount:X,playerHp:me,playerMaxHp:ge,maxEnemies:we}=wn({rows:n,cols:t,terrain:"."}),he=u(()=>W.value!=="playing"),q=u(()=>V.value==null&&W.value==="playing"),Z=u({get:()=>V.value!=null,set:$=>{$||J()}}),ye=u(()=>V.value?.enemyId??null);ce(()=>{S.value=x,w.value=pe}),se(()=>{S.value=null,w.value=null}),yn({onUp:U,onDown:M,onLeft:F,onRight:I,enabled:q});function xe(){Q("attack"),console.log("attack invoked")}function _e(){Q("run"),console.log("run invoked")}function be(){J()}function ke($){console.log("clicked",$)}return($,D)=>{const ee=m("v-col"),Ce=m("v-row"),Se=m("v-card-title"),Ee=m("v-card-text"),Me=m("v-btn"),Ie=m("v-card-actions"),Pe=m("v-card"),$e=m("v-dialog"),He=m("v-container");return A(),ie(He,{fluid:"",class:"hf-page pa-2"},{default:f(()=>[s(Ce,{class:Re(["hf-layout ga-3",{"flex-nowrap":!i.value,"flex-column":i.value}]),justify:"center",align:"center","no-gutters":""},{default:f(()=>[s(ee,{cols:"auto",class:"d-flex justify-center"},{default:f(()=>[s(Te,{cells:_(C),"cell-size-px":y.value,"gap-px":p.value,onCellClick:ke},null,8,["cells","cell-size-px","gap-px"])]),_:1}),s(ee,{cols:"auto",class:"d-flex justify-center"},{default:f(()=>[s(We,{disabled:!q.value,"btn-size-px":d.value,"gap-px":v.value,"pad-px":o.value,"on-up":_(U),"on-down":_(M),"on-left":_(F),"on-right":_(I)},null,8,["disabled","btn-size-px","gap-px","pad-px","on-up","on-down","on-left","on-right"])]),_:1})]),_:1},8,["class"]),s(Ye,{modelValue:Z.value,"onUpdate:modelValue":D[0]||(D[0]=Ae=>Z.value=Ae),"enemy-id":ye.value,hp:_(me),"max-hp":_(ge),infected:_(X),"max-enemies":_(we),onAttack:xe,onRun:_e,onClose:be},null,8,["modelValue","enemy-id","hp","max-hp","infected","max-enemies"]),s($e,{"model-value":he.value,"max-width":"420",persistent:""},{default:f(()=>[s(Pe,null,{default:f(()=>[s(Se,{class:"text-h6 text-center"},{default:f(()=>[H(P(_(W)==="won"?"You Win!":"Game Over"),1)]),_:1}),s(Ee,{class:"text-body-2 text-center"},{default:f(()=>[E("div",null,"Moves: "+P(_(ve)),1),E("div",xn,"Infected: "+P(_(X)),1)]),_:1}),s(Ie,null,{default:f(()=>[s(Me,{block:"",color:"primary",onClick:_(x)},{default:f(()=>[...D[1]||(D[1]=[H("Play Again",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])]),_:1})}}}),En=Y(kn,[["__scopeId","data-v-cd3f68fc"]]);export{En as default};
